(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.sensible=b())})(this,function(){'use strict';async function a(a){await t(),u(a),v(a);let b=!0;Object.keys(a.data).forEach(function(c){let d=a.data[c];if(Array.isArray(d)||d.hasOwnProperty("type")&&Array.isArray(d.type())){window[c]===void 0&&(window[c]=[]);let d=new w(window[c]);d.Observe(function(){a.persist&&a.data[c].hasOwnProperty("persist")&&!1!==a.data[c].persist&&localStorage.setItem(a.localPrefix+c,JSON.stringify(window[c])),b||k(c)})}else if(a.data[c].hasOwnProperty("type")&&a.data[c].type===Object){window[c]={};const d=new x(window,c,c);d.Observe(function(){b||k(c)}),Object.keys(a.data[c].default).forEach(function(a){window[c]={};const d=new x(window[c],a,c);d.Observe(function(){b||k(c)})})}else{const a=new x(window,c,!1);a.Observe(function(){b||k(c)})}let e=null;if(a.persist&&(!1===a.data[c].hasOwnProperty("persist")||!0===a.data[c].persist)){e=localStorage.getItem(a.localPrefix+c);try{e=JSON.parse(e)}catch(a){}}let f;f=null===e||"undefined"===e?d.default:e,d.hasOwnProperty("type")?d.type===Array?"undefined"!=typeof f&&Array.isArray(f)?f.forEach(a=>{window[c]===void 0&&(window[c]=[]),window[c].push(a)}):a.data[c].hasOwnProperty("default")&&a.data[c].default.forEach(a=>{window[c].push(a)}):d.type===Object?Object.keys(a.data[c].default).forEach(function(a){window[c][a]=f[a]}):window[c]=f:window[c]=f}),c(),b=!1}function b(a){"undefined"!=typeof store.data[a]&&store.data[a].hasOwnProperty("callBack")&&""!=store.data[a].callBack&&store.data[a].callBack.call(window[a])}function c(){try{i(),h(),g(),f(),e(),d()}catch(a){console.error(a)}}function d(){document.querySelectorAll("[s-unclick]").forEach(a=>{l(a)})}function e(){document.querySelectorAll("[s-click]").forEach(a=>{m(a)})}function f(){document.querySelectorAll("[s-css]").forEach(a=>{o(a)})}function g(){document.querySelectorAll("[s-for]").forEach(a=>{p(a)})}function h(){document.querySelectorAll("[s-if]").forEach(a=>{n(a)})}function i(){document.querySelectorAll("[s-bind]").forEach(a=>{j(a)})}function j(a){switch(a.type){case"select-one":a.onchange=function(b){if(q(b.target.value))try{let c=r(`'${b.target.value}'`);window[a.attributes["s-bind"].value]=s(c)}catch(a){console.error(a.message)}else window[a.attributes["s-bind"].value]=s(b.target.value.replace(/\+/g,""))},a.value=s(r(a.attributes["s-bind"].value));break;case"radio":a.onchange=function(b){window[a.attributes["s-bind"].value]=b.target.value},a.attributes["s-bind"].value===a.id&&(a.value=s(r(a.attributes["s-bind"].value))),a.checked=window[a.attributes["s-bind"].value]===a.value;break;case"checkbox":a.onchange=function(b){window[a.attributes["s-bind"].value]=b.target.checked},a.checked=window[a.attributes["s-bind"].value];break;case"text":case"email":case"textarea":let b="onkeyup";a.attributes["s-blur"]&&""===a.attributes["s-blur"].value&&(b="onblur"),a[b]=function(b){b.target.value===window[a.attributes["s-bind"].value]||(window[a.attributes["s-bind"].value]=b.target.value)},a.value=s(r(a.attributes["s-bind"].value));break;case"color":case"date":case"datetime-local":a.oninput=function(b){window[a.attributes["s-bind"].value]=b.target.value},a.value=s(r(a.attributes["s-bind"].value));break;case void 0:switch(a.tagName){case"IMG":let b=a.attributes["s-bind"].value;try{let c=s(b);return void(c&&(a.src=c,""===a.id&&(a.id=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10)),document.getElementById(a.id).src=c))}catch(a){return}}if(a.hasOwnProperty("originalInnerHTML")||(a.originalInnerHTML=a.innerHTML),""!==a.originalInnerHTML&&q(a.originalInnerHTML))try{let b=s(r(`${a.originalInnerHTML}`));switch(a.tagName){default:a.innerHTML=b;}break}catch(a){console.error(a.message)}a.innerHTML=window[a.attributes["s-bind"].value];}}function k(a){document.querySelectorAll("[s-bind]").forEach(b=>{(0<=b.innerHTML.indexOf(a)||0<=b.getAttribute("s-bind").indexOf(a)||b.getAttribute("s-bind")===a)&&j(b)}),document.querySelectorAll("[s-for]").forEach(b=>{(0<=b.innerHTML.indexOf(a)||0<=b.getAttribute("s-for").indexOf(a)||b.getAttribute("s-for")===a)&&p(b)}),document.querySelectorAll("[s-if]").forEach(b=>{(0<=b.innerHTML.indexOf(a)||0<=b.getAttribute("s-if").indexOf(a)||b.getAttribute("s-if")===a)&&n(b)}),document.querySelectorAll("[s-css]").forEach(b=>{(0<=b.innerHTML.indexOf(a)||0<=b.getAttribute("s-css").indexOf(a)||b.getAttribute("s-css")===a)&&o(b)}),b(a)}function l(a){try{const b=a.getAttribute("s-unclick");document.addEventListener("click",function(c){var d=a.contains(c.target);d||s(b)})}catch(a){console.error(a.message)}}function m(a){try{const b=a.getAttribute("s-click");document.addEventListener("click",function(c){var d=a.contains(c.target),e=c.target===a;(d||e)&&s(b)})}catch(a){console.error(a.message)}}function n(a){try{const b=s(a.getAttribute("s-if"));a.hasOwnProperty("originalDisplay")||(a.originalDisplay=a.style.display),a.style.display=b?"block":"none"}catch(a){console.error(a.message)}}function o(a){try{a.getAttribute("s-css").split(";").forEach(function(b){let c=b.substring(0,b.indexOf(":")).trim(),d=s(r(b.substring(b.indexOf(":")+1).trim()));d&&"undefined"!=typeof d.indexOf&&0<=d.indexOf("${")&&(d=s(d)),window[d]===void 0&&(d="'"+d+"'"),Object.assign(a.style,s(`{"${c}":${d}}`))})}catch(a){console.error(a.message)}}function p(a){try{let b,c;if(a.hasOwnProperty("templateElement"))b=a.templateElement.cloneNode(!0),c=a;else if(a.parentElement&&!a.parentElement.hasOwnProperty("originalNode"))c=a.parentElement,c.templateElement=a.cloneNode(!0),c.setAttribute("s-for",a.getAttribute("s-for")),c.setAttribute("s-key",a.getAttribute("s-key")),b=c.templateElement;else return void console.log("Unexpected route...");let d=b.getAttribute("s-for");if(""!==b.innerHTML&&q(b.innerHTML))try{let a="",e=r(b.innerHTML);if(0<=e.indexOf("${")&&(e=s(e)),0<=e.indexOf("s-src")&&(e=e.replace("s-src","src")),"OPTION"===b.tagName){let c=r(b.value);c&&1<c.length&&(a=r(b.value))}let f=new Function("parentElement","templateElement","innerHTML","value",`                                    var index = 0;                                    var newElements = [];                                    for (${d}) {                                        let newElement = templateElement.cloneNode(true);                                        newElement.removeAttribute('s-for');                                        newElement.removeAttribute('s-key');                                        let fn = new Function('index', '"use strict";return' + innerHTML + ';');                                        newElement.innerHTML = fn(index);                                        if (value !== '' && value !== undefined && value !== 'undefined') {                                            let fn = new Function('index', '"use strict";return' + value + ';');                                            newElement.value = fn(index);                                        }                                        let attribute = document.createAttribute("s-key-value");                                        attribute.value = index;                                        newElement.setAttributeNode(attribute);                                        newElements.push(newElement);                                        index++;                                    }                                    let child = parentElement.lastElementChild;                                    while (child) {                                        parentElement.removeChild(child);                                        child = parentElement.lastElementChild;                                    }                                    for (newElement of newElements) {                                        parentElement.appendChild(newElement);                                    }`);f(c,b,r("'"+e+"'"),a)}catch(a){console.error(a.message)}}catch(a){console.error(a.message)}}function q(a){return 0<a.substr(a.indexOf("{")+2,a.indexOf("}")-2).length}function r(a){return a.replace(/{/g,"' + ").replace(/}/g," + '").replace(/(\r\n|\n|\r)/gm,"")}function s(a){return new Function("\"use strict\";return "+a+";")()}function t(){return new Promise((a,b)=>{const c=function(){"loading"==document.readyState||(document.removeEventListener("readystatechange",c),"interactive"==document.readyState||"complete"==document.readyState?a():b(new Error("Unexpected document.readyState: "+document.readyState)))};"complete"==document.readyState?a():(document.addEventListener("readystatechange",c),c())}).catch(a=>(console.error(a),Promise.reject(a)))}function u(a){for(let b of document.querySelectorAll("[s-data]")){const c=b.getAttribute("s-data"),d=""===c?{}:c;try{const b=s(`${d}`);Object.assign(a.data,b)}catch(a){console.error(a)}}}function v(a){for(let b of document.querySelectorAll("[s-bind]")){let c=b.getAttribute("s-bind");null!==b.getAttribute("s-callback")&&(a.data[c].callBack=new Function("\"use strict\"; "+b.getAttribute("s-callback")))}}class w{constructor(b){let a=this;this.observers=[],this.Observe=function(b){a.observers.push(b)};try{b.push=function(){try{Array.prototype.push.apply(b,arguments)}catch(a){return console.log(a),!1}for(let b=0;b<a.observers.length;b++)a.observers[b](arguments,"push")},b.concat=function(c){let d=Array.prototype.concat.apply(b,c);for(let b=0;b<a.observers.length;b++)a.observers[b](d,"concat");return d},b.shift=function(){let c=Array.prototype.shift.apply(b,arguments),d=!1;for(let b=0;b<a.observers.length;b++)d=a.observers[b](c,"shift");return d?c:(b.unshift(c),null)},b.reverse=function(){let c=Array.prototype.reverse.apply(b,arguments);for(let b=0;b<a.observers.length;b++)a.observers[b](c,"reverse");return c},b.shift=function(){let c=Array.prototype.shift.apply(b,arguments);for(let b=0;b<a.observers.length;b++)a.observers[b](c,"shift");return c},b.sort=function(){let c=Array.prototype.sort.apply(b,arguments);for(let b=0;b<a.observers.length;b++)a.observers[b](c,"sort");return c},b.splice=function(c,d,e){let f;e?(Array.prototype.slice.call(arguments,2),f=e):f=Array.prototype.splice.apply(b,arguments);for(let b=0;b<a.observers.length;b++)a.observers[b](f,"splice");return f},b.unshift=function(){let c=Array.prototype.unshift.apply(b,arguments);for(let b=0;b<a.observers.length;b++)a.observers[b](c,"unshift");return arguments}}catch(a){console.log(a)}}}class x{constructor(a,b,c){let d=this,e=c;this.observers=[],this.Observe=function(a){d.observers.push(a)},Object.defineProperty(a,b,{set:function(a){d.value=a;for(let b=0;b<d.observers.length;b++)d.observers[b](a);let c=!1===e?b:e;store.persist&&(!store.data[c].hasOwnProperty("persist")||!0===store.data[c].persist)&&("object"==typeof a?localStorage.setItem(store.localPrefix+c+"."+b,JSON.stringify(a)):localStorage.setItem(store.localPrefix+b,a))},get:function(){return d.value}})}}const y={persist:!0,localPrefix:"__",data:{}};if(!(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")))return"undefined"==typeof store?(window.store=y,console.log("Store not defined."),a(y)):a(store)});

