(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.sensible=b())})(this,function(){'use strict';async function a(a){await u(),v(a),w(a);let c=!0;Object.keys(a.data).forEach(function(b){if(a.data[b].hasOwnProperty("type")&&a.data[b].type===Array){window[b]===void 0&&(window[b]=[]);let d=new s(window[b]);d.Observe(function(){a.persist&&a.data[b].hasOwnProperty("persist")&&!1!==a.data[b].persist&&localStorage.setItem(a.localPrefix+b,JSON.stringify(window[b])),c||j(b)})}else if(a.data[b].hasOwnProperty("type")&&a.data[b].type===Object){window[b]={};const d=new t(window,b,b);d.Observe(function(){c||j(b)}),Object.keys(a.data[b].default).forEach(function(a){window[b]={};const d=new t(window[b],a,b);d.Observe(function(){c||j(b)})})}else{const a=new t(window,b,!1);a.Observe(function(){c||j(b)})}let d=null,e=a.data[b];if(a.persist&&(!1===a.data[b].hasOwnProperty("persist")||!0===a.data[b].persist)){d=localStorage.getItem(a.localPrefix+b);try{d=JSON.parse(d)}catch(a){}}let f;f=null===d||"undefined"===d?e.default:d,e.hasOwnProperty("type")?e.type===Array?"undefined"!=typeof f&&Array.isArray(f)?f.forEach(a=>{window[b]===void 0&&(window[b]=[]),window[b].push(a)}):a.data[b].hasOwnProperty("default")&&a.data[b].default.forEach(a=>{window[b].push(a)}):e.type===Object?Object.keys(a.data[b].default).forEach(function(a){window[b][a]=f[a]}):window[b]=f:window[b]=f}),b(),c=!1}function b(){h(),g(),f(),e(),d(),c()}function c(){document.querySelectorAll("[s-unclick]").forEach(a=>{k(a)})}function d(){document.querySelectorAll("[s-click]").forEach(a=>{l(a)})}function e(){document.querySelectorAll("[s-css]").forEach(a=>{n(a)})}function f(){document.querySelectorAll("[s-for]").forEach(a=>{o(a)})}function g(){document.querySelectorAll("[s-if]").forEach(a=>{m(a)})}function h(){document.querySelectorAll("[s-bind]").forEach(a=>{i(a)})}function i(a){switch(a.type){case"select-one":a.onchange=function(b){if(p(b.target.value))try{let c=q(`'${b.target.value}'`);window[a.attributes["s-bind"].value]=r(c)}catch(a){console.error(a.message)}else window[a.attributes["s-bind"].value]=r(b.target.value.replace(/\+/g,""))},a.value=r(q(a.attributes["s-bind"].value));break;case"radio":a.onchange=function(b){window[a.attributes["s-bind"].value]=b.target.value},a.attributes["s-bind"].value===a.id&&(a.value=r(q(a.attributes["s-bind"].value))),a.checked=window[a.attributes["s-bind"].value]===a.value;break;case"checkbox":a.onchange=function(b){window[a.attributes["s-bind"].value]=b.target.checked},a.checked=window[a.attributes["s-bind"].value];break;case"text":case"email":case"textarea":let b="onkeyup";a.attributes["s-blur"]&&""===a.attributes["s-blur"].value&&(b="onblur"),a[b]=function(b){b.target.value===window[a.attributes["s-bind"].value]||(window[a.attributes["s-bind"].value]=b.target.value)},a.value=r(q(a.attributes["s-bind"].value));break;case"color":case"date":case"datetime-local":a.oninput=function(b){window[a.attributes["s-bind"].value]=b.target.value},a.value=r(q(a.attributes["s-bind"].value));break;case void 0:switch(a.tagName){case"IMG":let b=a.attributes["s-bind"].value;try{let c=r(b);return void(c&&(a.src=c,""===a.id&&(a.id=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10)),document.getElementById(a.id).src=c))}catch(a){return}}if(a.hasOwnProperty("originalInnerHTML")||(a.originalInnerHTML=a.innerHTML),""!==a.originalInnerHTML&&p(a.originalInnerHTML))try{let b=r(q(`'${a.originalInnerHTML}'`));switch(a.tagName){default:a.innerHTML=b;}break}catch(a){console.error(a.message)}a.innerHTML=window[a.attributes["s-bind"].value];}}function j(a){document.querySelectorAll("[s-bind]").forEach(b=>{(0<=b.innerHTML.indexOf(a)||0<=b.getAttribute("s-bind").indexOf(a)||b.getAttribute("s-bind")===a)&&i(b)}),document.querySelectorAll("[s-for]").forEach(b=>{(0<=b.innerHTML.indexOf(a)||0<=b.getAttribute("s-for").indexOf(a)||b.getAttribute("s-for")===a)&&o(b)}),document.querySelectorAll("[s-if]").forEach(b=>{(0<=b.innerHTML.indexOf(a)||0<=b.getAttribute("s-if").indexOf(a)||b.getAttribute("s-if")===a)&&m(b)}),document.querySelectorAll("[s-css]").forEach(b=>{(0<=b.innerHTML.indexOf(a)||0<=b.getAttribute("s-css").indexOf(a)||b.getAttribute("s-css")===a)&&n(b)}),executeCallBack(a)}function k(a){try{const b=a.getAttribute("s-unclick");document.addEventListener("click",function(c){var d=a.contains(c.target);d||r(b)})}catch(a){console.error(a.message)}}function l(a){try{const b=a.getAttribute("s-click");document.addEventListener("click",function(c){var d=a.contains(c.target);d&&r(b)})}catch(a){console.error(a.message)}}function m(a){try{const b=r(a.getAttribute("s-if"));a.hasOwnProperty("originalDisplay")||(a.originalDisplay=a.style.display),a.style.display=b?"block":"none"}catch(a){console.error(a.message)}}function n(a){try{a.getAttribute("s-css").split(";").forEach(function(b){let c=b.substring(0,b.indexOf(":")).trim(),d=r("'"+q(b.substring(b.indexOf(":")+1))+"'").trim();0<=d.indexOf("${")&&(d=r(d)),window[d]===void 0&&(d="'"+d+"'"),Object.assign(a.style,r(`{"${c}":${d}}`))})}catch(a){console.error(a.message)}}function o(a){try{let b,c;if(a.hasOwnProperty("templateElement"))b=a.templateElement.cloneNode(!0),c=a;else if(a.parentElement&&!a.parentElement.hasOwnProperty("originalNode"))c=a.parentElement,c.templateElement=a.cloneNode(!0),c.setAttribute("s-for",a.getAttribute("s-for")),c.setAttribute("s-key",a.getAttribute("s-key")),b=c.templateElement;else return void console.log("Unexpected route...");let d=b.getAttribute("s-for");if(""!==b.innerHTML&&p(b.innerHTML))try{let a="",e=q(b.innerHTML);if(0<=e.indexOf("${")&&(e=r(e)),0<=e.indexOf("s-src")&&(e=e.replace("s-src","src")),"OPTION"===b.tagName){let c=q(b.value);c&&1<c.length&&(a=q(b.value))}let f=new Function("parentElement","templateElement","innerHTML","value",`
                                    var index = 0;
                                    var newElements = [];
                                    for (${d}) {
                                        let newElement = templateElement.cloneNode(true);
                                        newElement.removeAttribute('s-for');
                                        newElement.removeAttribute('s-key');
                                        let fn = new Function('index', '"use strict";return' + innerHTML + ';');
                                        newElement.innerHTML = fn(index);
                                        if (value !== '' && value !== undefined && value !== 'undefined') {
                                            let fn = new Function('index', '"use strict";return' + value + ';');
                                            newElement.value = fn(index);
                                        }
                                        let attribute = document.createAttribute("s-key-value");
                                        attribute.value = index;
                                        newElement.setAttributeNode(attribute);
                                        newElements.push(newElement);
                                        index++;
                                    }
                                    let child = parentElement.lastElementChild;
                                    while (child) {
                                        parentElement.removeChild(child);
                                        child = parentElement.lastElementChild;
                                    }
                                    for (newElement of newElements) {
                                        parentElement.appendChild(newElement);
                                    }`);f(c,b,q("'"+e+"'"),a)}catch(a){console.error(a.message)}}catch(a){console.error(a.message)}}function p(a){return 0<a.substr(a.indexOf("{")+2,a.indexOf("}")-2).length}function q(a){return a.replace(/{/g,"' + ").replace(/}/g," + '").replace(/(\r\n|\n|\r)/gm,"")}function r(a){return new Function("\"use strict\";return "+a+";")()}function s(b){let a=this;this.observers=[],this.Observe=function(b){a.observers.push(b)};try{b.push=function(c){let d=Array.prototype.push.apply(b,arguments);for(let b=0;b<a.observers.length;b++)a.observers[b](c,"push");return d},b.concat=function(c){let d=Array.prototype.concat.apply(b,c);for(let b=0;b<a.observers.length;b++)a.observers[b](d,"concat");return d},b.pop=function(){let c=Array.prototype.pop.apply(b,arguments);for(let b=0;b<a.observers.length;b++)a.observers[b](c,"pop");return c},b.reverse=function(){let c=Array.prototype.reverse.apply(b,arguments);for(let b=0;b<a.observers.length;b++)a.observers[b](c,"reverse");return c},b.shift=function(){let c=Array.prototype.shift.apply(b,arguments);for(let b=0;b<a.observers.length;b++)a.observers[b](c,"shift");return c},b.sort=function(){let c=Array.prototype.sort.apply(b,arguments);for(let b=0;b<a.observers.length;b++)a.observers[b](c,"sort");return c},b.splice=function(c,d,e){let f;e?(Array.prototype.slice.call(arguments,2),f=e):f=Array.prototype.splice.apply(b,arguments);for(let b=0;b<a.observers.length;b++)a.observers[b](f,"splice");return f},b.unshift=function(){let c=Array.prototype.unshift.apply(b,arguments);for(let b=0;b<a.observers.length;b++)a.observers[b](c,"unshift");return arguments}}catch(a){console.log(a)}}function t(a,b,c){let d=this,e=c;this.observers=[],this.Observe=function(a){d.observers.push(a)},Object.defineProperty(a,b,{set:function(a){d.value=a;for(let b=0;b<d.observers.length;b++)d.observers[b](a);let c=!1===e?b:e;store.persist&&(!store.data[c].hasOwnProperty("persist")||!0===store.data[c].persist)&&("object"==typeof a?localStorage.setItem(store.localPrefix+c+"."+b,JSON.stringify(a)):localStorage.setItem(store.localPrefix+b,a))},get:function(){return d.value}})}function u(){return new Promise(a=>{"loading"==document.readyState?document.addEventListener("DOMContentLoaded",a):a()})}function v(a){for(let b of document.querySelectorAll("[s-data]")){const c=b.getAttribute("s-data"),d=""===c?{}:c;try{}catch(a){console.error(a)}const e=r(`${d}`);Object.assign(a.data,e)}}function w(a){for(let b of document.querySelectorAll("[s-bind]")){let c=b.getAttribute("s-bind");null!==b.getAttribute("s-callback")&&(a.data[c].callBack=new Function("\"use strict\"; "+b.getAttribute("s-callback")))}}const x={persist:!0,localPrefix:"__",data:{}};if(!(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")))return"undefined"==typeof store?(window.store=x,console.log("Store not defined."),a(x)):a(store)});

